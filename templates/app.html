{% extends "base.html" %}

{% block content %}
  <div class="my-3">
    <div class="mb-3">
      <h1 class="mb-0">{{app.name}}</h1>
      <a href="https://{{ app.name }}.rajdhani.pipal.in" class="text-decoration-none" target="_blank">
        Visit website
      </a>
    </div>
    <div>{{app.score}} tasks completed | Current Task: {{ app.current_task }} | Last updated {{datestr(app.last_updated) }}</div>
  </div>

  <h2>Tasks</h2>

  {% for task in tasks %}

  {% set task_status = app.get_task_status(task.name) %}
  {% set card_style = 'border-success text-success'     if task_status == 'success' else (
                      'border-warning'                  if task_status == 'current' else (
                      'border-danger text-danger'       if task_status == 'failing' else
                      'border-secondary text-secondary' )) %}

  <div class="card my-2 {{ card_style }}">
    <div class="card-body py-3">
      {% set task_id = "task-%d"|format(loop.index) %}
      <a href="#{{ task_id }}" data-bs-toggle="collapse" class="text-decoration-none" style="color: inherit;">
        <h5 class="card-title mb-0">Task {{loop.index}}: {{task.title}}</h5>
      </a>
      <div class="collapse {{ 'show' if task.name == app.current_task }}" id="{{ task_id }}">
        <p class="card-text">{{markdown_to_html(task.description)}}</p>

        <p class="text-muted">
        {% if app.is_task_done(task.name) %}Status: Complete
        {% else %}Status: Pending
        {% endif %}
        </p>
      </div>
    </div>
  </div>
  {% endfor %}

  <div class="my-3">
    <h2>Change Log</h2>
    {% for entry in app.get_changelog() %}
    <div>{{datestr(entry.timestamp)}} - {{entry.type}} - {{entry.message}}</div>
    {% endfor %}
  </div>

  {% endblock %}
